<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<title>Winapp2 Entry Writing Helper</title>
	<style>
		main
		{
			font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji';
			line-height: 1.5;
			width: 700px;
			margin: auto;
			margin-top: 20px;
		}
		main, select, textarea
		{
			font-size: 18px;
		}
	</style>
	<link rel="shortcut icon" href="favicon.ico">
</head>
<body>

<main>
	<p>
		Entry Name *
		<input type="text" class="entryName" spellcheck="false" autofocus>
	</p>

	<p>
		OS Selection Mode
		<select class="osMode" onchange="enableOS()">
			<option>None</option>
			<option>Strict OS Version</option>
			<option>Minimum OS Version</option>
			<option>Maximum OS Version</option>
		</select>
	</p>

	<p>
		Operating System
		<select class="osName" disabled>
			<option value="5.0">Windows 2000</option>
			<option value="5.1">Windows XP</option>
			<option value="5.2">Windows XP 64-Bit Edition, Windows Server 2003, Windows Home Server</option>
			<option value="6.0">Windows Vista, Windows Server 2008</option>
			<option value="6.1">Windows 7, Windows Server 2008 R2, Windows Home Server 2011</option>
			<option value="6.2">Windows 8, Windows Server 2012</option>
			<option value="6.3">Windows 8.1, Windows Server 2012 R2</option>
			<option value="10.0">Windows 10, Windows Server 2016, Windows Server 2019</option>
		</select>
	</p>

	<p>
		Section
		<select class="section">
			<option>None</option>
			<option value="3001">Internet Explorer</option>
			<option value="3005">Microsoft Edge</option>
			<option value="3006">Edge Chromium</option>
			<option value="3021" selected>Applications</option>
			<option value="3022">Internet</option>
			<option value="3023">Multimedia</option>
			<option value="3024">Utilities</option>
			<option value="3025">Windows</option>
			<option value="3026">Firefox</option>
			<option value="3027">Opera</option>
			<option value="3028">Safari</option>
			<option value="3029">Google Chrome</option>
			<option value="3030">Thunderbird</option>
			<option value="3031">Windows Store</option>
			<option value="3032">CCleaner Browser</option>
			<option value="3033">Vivaldi</option>
			<option value="3034">Brave</option>
			<option>Language Files</option>
			<option>Dangerous Applications</option>
			<option>Dangerous Brave</option>
			<option>Dangerous Edge Chromium</option>
			<option>Dangerous Firefox</option>
			<option>Dangerous Games</option>
			<option>Dangerous Google Chrome</option>
			<option>Dangerous Internet</option>
			<option>Dangerous Internet Explorer</option>
			<option>Dangerous Long</option>
			<option>Dangerous Multimedia</option>
			<option>Dangerous Opera</option>
			<option>Dangerous Utilities</option>
			<option>Dangerous Vivaldi</option>
			<option>Dangerous Windows</option>
			<option>Dangerous Windows Store</option>
		</select>
	</p>

	<div>
		<p onclick="toggleMe( 'registryDetect' )">Registry Keys to Detect</p>
		<textarea class="registryDetect" cols="90" rows="1" spellcheck="false"></textarea>
	</div>

	<div>
		<p onclick="toggleMe( 'fileFolderDetect' )">Files / Folders to Detect</p>
		<textarea class="fileFolderDetect" cols="90" rows="1" spellcheck="false"></textarea>
	</div>

	<div>
		<p onclick="toggleMe( 'warning' )">Warning</p>
		<textarea class="warning" cols="90" rows="1"></textarea>
	</div>

	<div>
		<p onclick="toggleMe( 'fileFolderRemovals' )">Files / Folders to Remove</p>
		<textarea class="fileFolderRemovals" cols="90" rows="1" spellcheck="false"></textarea>
	</div>

	<div>
		<p onclick="toggleMe( 'registryKeyRemovals' )">Registry Keys to Remove</p>
		<textarea class="registryKeyRemovals" cols="90" rows="1" spellcheck="false"></textarea>
	</div>

	<div>
		<p onclick="toggleMe( 'excludeKeys' )">Exclude Keys</p>
		<textarea class="excludeKeys" cols="90" rows="1" spellcheck="false"></textarea>
	</div>

	<div>
		<p>
			<button onclick="createEntry()" class="createButton">Create Entry</button>
			<button onclick="copy2Clipboard()" class="copyButton">Copy</button>
		</p>
		<textarea class="finalEntry" cols="90" rows="2" spellcheck="false"></textarea>
	</div>
</main>


<script>
	function createEntry()
	{
		let finalText = '';

		// Get Entry Name
		if ( document.querySelector( '.entryName' ).value === '' )
		{
			alert( 'Please provide the name of the software.' );
			document.querySelector( '.entryName' ).focus();
			return;
		}
		else
		{
			finalText += '[' + document.querySelector( '.entryName' ).value + ' *]';
		}

		// Get OS Selection
		let osmode = document.querySelector( '.osMode' ).value;
		let osname = document.querySelector( '.osName' ).value;

		if ( osmode === 'Strict OS Version' )
		{
			finalText += '\nDetectOS=' + osname	+ '|' + osname;
		}
		else if ( osmode === 'Minimum OS Version' )
		{
			finalText += '\nDetectOS=' + osname	+ '|';
		}
		else if ( osmode === 'Maximum OS Version' )
		{
			finalText += '\nDetectOS=' + '|' + osname;
		}

		// Get Section Name
		let sectionName = document.querySelector( '.section' ).value;
		if ( sectionName !== 'None' )
		{
			if ( sectionName === 'Language Files' || sectionName === 'License Text Files' )
			{
				finalText += '\nSection=' + document.querySelector( '.section' ).value;
			}
			else
			{
				finalText += '\nLangSecRef=' + document.querySelector( '.section' ).value;
			}
		}

		// Show error if both 'Registry Keys to Detect' &
		// 'Files / Folders to Detect' are empty
		if ( document.querySelector( '.registryDetect' ).value === '' && document.querySelector( '.fileFolderDetect' ).value === '' )
		{
			alert( "Please provide at least one of 'Registry Keys to Detect' "
					+ "and 'Files / Folders to Detect'." );
			document.querySelector( '.registryDetect' ).focus();
			return;
		}

		// Get Registry Entry Detection
		if ( document.querySelector( '.registryDetect' ).value !== '' )
		{
			// See if detect is multi-line
			let regDetectParts = document.querySelector( '.registryDetect' ).value.split( '\n' );
			if ( regDetectParts.length > 1 )
			{
				for( i in regDetectParts )
				{
					finalText += '\nDetect';
					finalText += parseInt( i ) + 1;
					finalText += '=' + regDetectParts[ i ];
				}
			}
			else
			{
				finalText += '\nDetect=' + regDetectParts;
			}
		}

		// File / Folder Detection
		if ( document.querySelector( '.fileFolderDetect' ).value !== '' )
		{
			// See if DetectFile is multi-line
			let fileFolderDetectParts = document.querySelector( '.fileFolderDetect' ).value.split( '\n' );
			if ( fileFolderDetectParts.length > 1 )
			{
				for( i in fileFolderDetectParts )
				{
					finalText += '\nDetectFile';
					finalText += parseInt( i ) + 1;
					finalText += '=' + replaceEnvVar ( fileFolderDetectParts[ i ] );
				}
			}
			else
			{
				finalText += '\nDetectFile=' + replaceEnvVar ( fileFolderDetectParts[ 0 ] );
			}
		}

		// Get Warning Message
		if ( document.querySelector( '.warning' ).value !== '' )
		{
			finalText += '\nWarning=' + document.querySelector( '.warning' ).value;
		}

		// Show error if both 'Files / Folders to Remove' &
		// 'Registry Keys to Remove' are empty
		if ( document.querySelector( '.fileFolderRemovals' ).value === '' && document.querySelector( '.registryKeyRemovals' ).value === '' )
		{
			alert( "Please provide at least one of 'Files / Folders to Remove' "
					+ "and 'Registry Keys to Remove'." );
			document.querySelector( '.fileFolderRemovals' ).focus();
			return;
		}

		// File / Folder for Removal
		if ( document.querySelector( '.fileFolderRemovals' ).value !== '' )
		{
			let fileFolderRemovalsParts = document.querySelector( '.fileFolderRemovals' ).value.split( '\n' );
			for( i in fileFolderRemovalsParts )
			{
				finalText += '\nFileKey';
				finalText += parseInt( i ) + 1;
				finalText += '=' + replaceEnvVar ( fileFolderRemovalsParts[ i ] );
			}
		}

		// Registry Keys for Removal
		if ( document.querySelector( '.registryKeyRemovals' ).value !== '' )
		{
			let registryKeyRemovalsParts = document.querySelector( '.registryKeyRemovals' ).value.split( '\n' );
			for( i in registryKeyRemovalsParts )
			{
				finalText += '\nRegKey';
				finalText += parseInt( i ) + 1;
				finalText += '=' + registryKeyRemovalsParts[ i ];
			}
		}

		// Exclude Keys for Removal
		if ( document.querySelector( '.excludeKeys' ).value !== '' )
		{
			let excludeKeysParts = document.querySelector( '.excludeKeys' ).value.split( '\n' );
			for( i in excludeKeysParts )
			{
				finalText += '\nExcludeKey';
				finalText += parseInt( i ) + 1;
				finalText += '=' + excludeKeysParts[ i ];
			}
		}

		document.querySelector( '.finalEntry' ).innerHTML = finalText;
		document.querySelector( '.finalEntry' ).style.height = 'auto';
		document.querySelector( '.finalEntry' ).style.height = document.querySelector( '.finalEntry' ).scrollHeight + 'px';
		document.querySelector( '.createButton' ).innerText = '🎉 Created!';
		setTimeout( function(){document.querySelector( '.createButton' ).innerText = 'Create Entry';}, 3000 );
	} // createEntry()

	// Replace paths with environment variables
	function replaceEnvVar( txt )
	{
		let paths =
		[
			'C:\\Users\\%UserName%\\AppData\\LocalLow',
			'C:\\Users\\%UserName%\\AppData\\Local',
			'C:\\Users\\%UserName%\\AppData\\Roaming',
			'C:\\Users\\%UserName%\\Documents',
			'C:\\Users\\%UserName%\\Music',
			'C:\\Users\\%UserName%\\Pictures',
			'C:\\Users\\%UserName%\\Videos',
			'C:\\Users\\%UserName%',
			'C:\\Program Files\\Common Files',
			'C:\\Program Files (x86)',
			'C:\\Program Files',
			'C:\\ProgramData',
			'C:\\Users\\Public',
			'C:\\Windows',
			'C:'
		];
		let envVar =
		[
			'%LocalLowAppData%',
			'%LocalAppData%',
			'%AppData%',
			'%Documents%',
			'%Music%',
			'%Pictures%',
			'%Video%',
			'%UserProfile%',
			'%CommonProgramFiles%',
			'%ProgramFiles%',
			'%ProgramFiles%',
			'%CommonAppData%',
			'%Public%',
			'%WinDir%',
			'%SystemDrive%'
		];
		for ( i in paths )
		{
			txt = txt.replace( paths[ i ], envVar[ i ] );
		}
		return txt;
	}

	// Enable / disable OS selection drop down
	function enableOS()
	{
		if ( document.querySelector( '.osMode' ).value === 'None' )
		{
			document.querySelector( '.osName' ).setAttribute( 'disabled', 'disabled' );
		}
		else
		{
			document.querySelector( '.osName' ).removeAttribute( 'disabled' );
		}
	}

	// Copy entry to clipboard
	function copy2Clipboard()
	{
		navigator.clipboard.writeText( document.querySelector( '.finalEntry' ).value );
		document.querySelector( '.copyButton' ).innerText = '✔️ Copied!';
		setTimeout( function(){document.querySelector( '.copyButton' ).innerText = 'Copy';}, 3000 );
	}

	// Toggle visibility of fields on click on related field name
	function toggleMe( targetClass )
	{
		let ele = document.querySelector( '.' + targetClass );
		if ( ele.style.display === '' )
		{
			ele.style.display = 'none';
		}
		else
		{
			ele.style.display = '';
		}
	}

	// Text Area Auto Grow Script
	for ( e of document.querySelectorAll( 'textarea' ) )
	{
		for ( s of [ 'keyup', 'keydown', 'change', 'cut', 'paste', 'drop' ] )
		{
			e.addEventListener( s, resizeTextarea );
		}
	}
	function resizeTextarea()
	{
		this.style.height = 'auto';
		this.style.height = this.scrollHeight + 'px';
	}
</script>

</body>
</html>
